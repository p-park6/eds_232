% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Lab1},
  pdfauthor={Patricia Park},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Lab1}
\author{Patricia Park}
\date{2024-01-24}

\begin{document}
\maketitle

\hypertarget{case-study-the-pumpkin-market}{%
\section{Case Study: The Pumpkin
Market}\label{case-study-the-pumpkin-market}}

The data you just loaded includes 1757 lines of data about the market
for pumpkins, sorted into groupings by city. This is raw data extracted
from the Specialty Crops Terminal Markets Standard Reports distributed
by the United States Department of Agriculture.

You are loading a pumpkin data set in order to ask questions of it:

When is the best time to buy pumpkins?

What price can I expect of a case of miniature pumpkins?

Should I buy them in half-bushel baskets or by the 1 1/9 bushel box?

\hypertarget{examine-the-data}{%
\subsection{Examine the data}\label{examine-the-data}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{glimpse}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 1,757
## Columns: 27
## $ ...1              <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1~
## $ `City Name`       <chr> "BALTIMORE", "BALTIMORE", "BALTIMORE", "BALTIMORE", ~
## $ Type              <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Package           <chr> "24 inch bins", "24 inch bins", "24 inch bins", "24 ~
## $ Variety           <chr> NA, NA, "HOWDEN TYPE", "HOWDEN TYPE", "HOWDEN TYPE",~
## $ `Sub Variety`     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Grade             <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Date              <chr> "4/29/17", "5/6/17", "9/24/16", "9/24/16", "11/5/16"~
## $ `Low Price`       <dbl> 270, 270, 160, 160, 90, 90, 160, 160, 160, 160, 160,~
## $ `High Price`      <dbl> 280, 280, 160, 160, 100, 100, 170, 160, 170, 160, 17~
## $ `Mostly Low`      <dbl> 270, 270, 160, 160, 90, 90, 160, 160, 160, 160, 160,~
## $ `Mostly High`     <dbl> 280, 280, 160, 160, 100, 100, 170, 160, 170, 160, 17~
## $ Origin            <chr> "MARYLAND", "MARYLAND", "DELAWARE", "VIRGINIA", "MAR~
## $ `Origin District` <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ `Item Size`       <chr> "lge", "lge", "med", "med", "lge", "lge", "med", "lg~
## $ Color             <chr> NA, NA, "ORANGE", "ORANGE", "ORANGE", "ORANGE", "ORA~
## $ Environment       <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ `Unit of Sale`    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Quality           <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Condition         <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Appearance        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Storage           <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Crop              <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ Repack            <chr> "E", "E", "N", "N", "N", "N", "N", "N", "N", "N", "N~
## $ `Trans Mode`      <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ ...26             <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
## $ ...27             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Clean names to the snake\_case convention}

\NormalTok{pumpkins }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{clean\_names}\NormalTok{(}\AttributeTok{case =} \StringTok{"snake"}\NormalTok{)}

\CommentTok{\# Return column names}

\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "x1"              "city_name"       "type"            "package"        
##  [5] "variety"         "sub_variety"     "grade"           "date"           
##  [9] "low_price"       "high_price"      "mostly_low"      "mostly_high"    
## [13] "origin"          "origin_district" "item_size"       "color"          
## [17] "environment"     "unit_of_sale"    "quality"         "condition"      
## [21] "appearance"      "storage"         "crop"            "repack"         
## [25] "trans_mode"      "x26"             "x27"
\end{verbatim}

\hypertarget{select-desired-columns}{%
\subsection{Select desired columns}\label{select-desired-columns}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pumpkins }\OtherTok{\textless{}{-}}\NormalTok{ pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(variety, city\_name, package, low\_price, high\_price, date)}


\DocumentationTok{\#\# Print data set}
\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 6
##   variety     city_name package      low_price high_price date   
##   <chr>       <chr>     <chr>            <dbl>      <dbl> <chr>  
## 1 <NA>        BALTIMORE 24 inch bins       270        280 4/29/17
## 2 <NA>        BALTIMORE 24 inch bins       270        280 5/6/17 
## 3 HOWDEN TYPE BALTIMORE 24 inch bins       160        160 9/24/16
## 4 HOWDEN TYPE BALTIMORE 24 inch bins       160        160 9/24/16
## 5 HOWDEN TYPE BALTIMORE 24 inch bins        90        100 11/5/16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Load lubridate}

\FunctionTok{library}\NormalTok{(lubridate)}

\CommentTok{\# Extract the month and day from the dates and add as new columns}
\NormalTok{pumpkins }\OtherTok{\textless{}{-}}\NormalTok{ pumpkins }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{date =} \FunctionTok{mdy}\NormalTok{(date),  }
         \AttributeTok{day =} \FunctionTok{yday}\NormalTok{(date),}
         \AttributeTok{month =} \FunctionTok{month}\NormalTok{(date))}
\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{day)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,757 x 7
##    variety     city_name package      low_price high_price date       month
##    <chr>       <chr>     <chr>            <dbl>      <dbl> <date>     <dbl>
##  1 <NA>        BALTIMORE 24 inch bins       270        280 2017-04-29     4
##  2 <NA>        BALTIMORE 24 inch bins       270        280 2017-05-06     5
##  3 HOWDEN TYPE BALTIMORE 24 inch bins       160        160 2016-09-24     9
##  4 HOWDEN TYPE BALTIMORE 24 inch bins       160        160 2016-09-24     9
##  5 HOWDEN TYPE BALTIMORE 24 inch bins        90        100 2016-11-05    11
##  6 HOWDEN TYPE BALTIMORE 24 inch bins        90        100 2016-11-12    11
##  7 HOWDEN TYPE BALTIMORE 36 inch bins       160        170 2016-09-24     9
##  8 HOWDEN TYPE BALTIMORE 36 inch bins       160        160 2016-09-24     9
##  9 HOWDEN TYPE BALTIMORE 36 inch bins       160        170 2016-10-01    10
## 10 HOWDEN TYPE BALTIMORE 36 inch bins       160        160 2016-10-01    10
## # i 1,747 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# View the first few rows}

\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 8
##   variety     city_name package      low_price high_price date         day month
##   <chr>       <chr>     <chr>            <dbl>      <dbl> <date>     <dbl> <dbl>
## 1 <NA>        BALTIMORE 24 inch bins       270        280 2017-04-29   119     4
## 2 <NA>        BALTIMORE 24 inch bins       270        280 2017-05-06   126     5
## 3 HOWDEN TYPE BALTIMORE 24 inch bins       160        160 2016-09-24   268     9
## 4 HOWDEN TYPE BALTIMORE 24 inch bins       160        160 2016-09-24   268     9
## 5 HOWDEN TYPE BALTIMORE 24 inch bins        90        100 2016-11-05   310    11
## 6 HOWDEN TYPE BALTIMORE 24 inch bins        90        100 2016-11-12   317    11
## 7 HOWDEN TYPE BALTIMORE 36 inch bins       160        170 2016-09-24   268     9
\end{verbatim}

There are two column dealing with price, high and low. Let's combine
them into a single average price column.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a new column price}
\NormalTok{pumpkins }\OtherTok{\textless{}{-}}\NormalTok{ pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{price =}\NormalTok{ (low\_price}\SpecialCharTok{+}\NormalTok{ high\_price)}\SpecialCharTok{/}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Let's take a look at pumpkins sales throughout the year.

\emph{Question 1:} Create a scatter plot using price on the y-axis and
day on the x-axis.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Make a scatter plot of month and price}

\NormalTok{price\_day }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ pumpkins, }
                    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ day,}
                        \AttributeTok{y =}\NormalTok{ price)) }\SpecialCharTok{+}
  \FunctionTok{geom\_jitter}\NormalTok{()}

\FunctionTok{print}\NormalTok{(price\_day)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Lab1_files/figure-latex/unnamed-chunk-5-1.pdf}

Now, before we go any further, let's take another look at the data.
Notice anything odd?

That's right: pumpkins are sold in many different configurations. Some
are sold in 1 1/9 bushel measures, and some in 1/2 bushel measures, some
per pumpkin, some per pound, and some in big boxes with varying widths.

Let's verify this:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Verify the distinct observations in Package column}
\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(package)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 1
##    package             
##    <chr>               
##  1 24 inch bins        
##  2 36 inch bins        
##  3 50 lb sacks         
##  4 1 1/9 bushel cartons
##  5 1/2 bushel cartons  
##  6 1 1/9 bushel crates 
##  7 bushel cartons      
##  8 bins                
##  9 35 lb cartons       
## 10 each                
## 11 20 lb cartons       
## 12 50 lb cartons       
## 13 40 lb cartons       
## 14 bushel baskets      
## 15 22 lb cartons
\end{verbatim}

Pumpkins seem to be very hard to weigh consistently, so let's filter
them by selecting only pumpkins with the string bushel in the package
column and put this in a new data frame ``new\_pumpkins''.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# View the first few rows of the data}

\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 9
##   variety    city_name package low_price high_price date         day month price
##   <chr>      <chr>     <chr>       <dbl>      <dbl> <date>     <dbl> <dbl> <dbl>
## 1 <NA>       BALTIMORE 24 inc~       270        280 2017-04-29   119     4   275
## 2 <NA>       BALTIMORE 24 inc~       270        280 2017-05-06   126     5   275
## 3 HOWDEN TY~ BALTIMORE 24 inc~       160        160 2016-09-24   268     9   160
## 4 HOWDEN TY~ BALTIMORE 24 inc~       160        160 2016-09-24   268     9   160
## 5 HOWDEN TY~ BALTIMORE 24 inc~        90        100 2016-11-05   310    11    95
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(package)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 1
##    package             
##    <chr>               
##  1 24 inch bins        
##  2 36 inch bins        
##  3 50 lb sacks         
##  4 1 1/9 bushel cartons
##  5 1/2 bushel cartons  
##  6 1 1/9 bushel crates 
##  7 bushel cartons      
##  8 bins                
##  9 35 lb cartons       
## 10 each                
## 11 20 lb cartons       
## 12 50 lb cartons       
## 13 40 lb cartons       
## 14 bushel baskets      
## 15 22 lb cartons
\end{verbatim}

\emph{Question} 2: Use a combination of dplyr::filter() and
stringr::str\_detect() to achieve what we want.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Retain only pumpkins with "bushel" in the package column}

\NormalTok{new\_pumpkins }\OtherTok{\textless{}{-}}\NormalTok{ pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(package, }\StringTok{"bushel"}\NormalTok{))}

\NormalTok{new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 9
##   variety  city_name package   low_price high_price date         day month price
##   <chr>    <chr>     <chr>         <dbl>      <dbl> <date>     <dbl> <dbl> <dbl>
## 1 PIE TYPE BALTIMORE 1 1/9 bu~        15         15 2016-09-24   268     9    15
## 2 PIE TYPE BALTIMORE 1 1/9 bu~        18         18 2016-09-24   268     9    18
## 3 PIE TYPE BALTIMORE 1 1/9 bu~        18         18 2016-10-01   275    10    18
## 4 PIE TYPE BALTIMORE 1 1/9 bu~        17         17 2016-10-01   275    10    17
## 5 PIE TYPE BALTIMORE 1 1/9 bu~        15         15 2016-10-08   282    10    15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(package)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 1
##   package             
##   <chr>               
## 1 1 1/9 bushel cartons
## 2 1/2 bushel cartons  
## 3 1 1/9 bushel crates 
## 4 bushel cartons      
## 5 bushel baskets
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get the dimensions of the new data}
\FunctionTok{dim}\NormalTok{(new\_pumpkins)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 415   9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View a few rows of the new data}
\NormalTok{new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    variety  city_name package  low_price high_price date         day month price
##    <chr>    <chr>     <chr>        <dbl>      <dbl> <date>     <dbl> <dbl> <dbl>
##  1 PIE TYPE BALTIMORE 1 1/9 b~        15       15   2016-09-24   268     9  15  
##  2 PIE TYPE BALTIMORE 1 1/9 b~        18       18   2016-09-24   268     9  18  
##  3 PIE TYPE BALTIMORE 1 1/9 b~        18       18   2016-10-01   275    10  18  
##  4 PIE TYPE BALTIMORE 1 1/9 b~        17       17   2016-10-01   275    10  17  
##  5 PIE TYPE BALTIMORE 1 1/9 b~        15       15   2016-10-08   282    10  15  
##  6 PIE TYPE BALTIMORE 1 1/9 b~        18       18   2016-10-08   282    10  18  
##  7 PIE TYPE BALTIMORE 1 1/9 b~        17       17   2016-10-08   282    10  17  
##  8 PIE TYPE BALTIMORE 1 1/9 b~        17       18.5 2016-10-08   282    10  17.8
##  9 PIE TYPE BALTIMORE 1 1/9 b~        15       15   2016-10-15   289    10  15  
## 10 PIE TYPE BALTIMORE 1 1/9 b~        17       17   2016-10-15   289    10  17
\end{verbatim}

You should see that we have narrowed down to 415 rows of data containing
pumpkins measured in bushels.

But wait! There's one more thing to do.

Did you notice that the bushel amount varies per row? You need to
normalize the pricing so that you show the pricing per bushel, not per 1
1/9 or 1/2 bushel. Time to do some math to standardize it.

We'll use the function case\_when() to mutate the Price column depending
on some conditions. case\_when() allows you to vectorize multiple
if\_else()statements.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert the price if the Package contains fractional bushel values}
\NormalTok{new\_pumpkins }\OtherTok{\textless{}{-}}\NormalTok{ new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{price =} \FunctionTok{case\_when}\NormalTok{(}
    \FunctionTok{str\_detect}\NormalTok{(package, }\StringTok{"1 1/9"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ price}\SpecialCharTok{/}\NormalTok{(}\FloatTok{1.1}\NormalTok{),}
    \FunctionTok{str\_detect}\NormalTok{(package, }\StringTok{"1/2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ price}\SpecialCharTok{*}\DecValTok{2}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ price))}

\CommentTok{\# View the first few rows of the data}
\NormalTok{new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 30 x 9
##    variety  city_name package  low_price high_price date         day month price
##    <chr>    <chr>     <chr>        <dbl>      <dbl> <date>     <dbl> <dbl> <dbl>
##  1 PIE TYPE BALTIMORE 1 1/9 b~        15       15   2016-09-24   268     9  13.6
##  2 PIE TYPE BALTIMORE 1 1/9 b~        18       18   2016-09-24   268     9  16.4
##  3 PIE TYPE BALTIMORE 1 1/9 b~        18       18   2016-10-01   275    10  16.4
##  4 PIE TYPE BALTIMORE 1 1/9 b~        17       17   2016-10-01   275    10  15.5
##  5 PIE TYPE BALTIMORE 1 1/9 b~        15       15   2016-10-08   282    10  13.6
##  6 PIE TYPE BALTIMORE 1 1/9 b~        18       18   2016-10-08   282    10  16.4
##  7 PIE TYPE BALTIMORE 1 1/9 b~        17       17   2016-10-08   282    10  15.5
##  8 PIE TYPE BALTIMORE 1 1/9 b~        17       18.5 2016-10-08   282    10  16.1
##  9 PIE TYPE BALTIMORE 1 1/9 b~        15       15   2016-10-15   289    10  13.6
## 10 PIE TYPE BALTIMORE 1 1/9 b~        17       17   2016-10-15   289    10  15.5
## # i 20 more rows
\end{verbatim}

\hypertarget{data-visualization}{%
\subsection{Data Visualization}\label{data-visualization}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Set theme}
\FunctionTok{theme\_set}\NormalTok{(}\FunctionTok{theme\_light}\NormalTok{())}

\CommentTok{\# Make a scatter plot of day and price}
\NormalTok{new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ day, }\AttributeTok{y =}\NormalTok{ price)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \FloatTok{1.6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Lab1_files/figure-latex/unnamed-chunk-11-1.pdf}

\emph{Question 3:} Is this a useful plot? Does anything about it
surprise you?

\begin{itemize}
\tightlist
\item
  \textbf{Answer}: While I wouldn't say that this plot is useful, I
  would say that one of the information that I can gain from it is how
  consistent the price stays as the days go by.
\end{itemize}

How do we make it more useful? To get charts to display useful data, you
usually need to group the data somehow.

\emph{Question 4:} Group the pumpkins into groups based on the month
column and then find the mean price for each month. Plot the results
with a bar plot.

Hint: use dplyr::group\_by() \%\textgreater\% summarize()

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Find the average price of pumpkins per month}
\NormalTok{new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(month) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean\_price =} \FunctionTok{mean}\NormalTok{(price)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ month, }\AttributeTok{y =}\NormalTok{ mean\_price)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{fill =} \StringTok{"pink"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean Pumpkin Price"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Lab1_files/figure-latex/unnamed-chunk-12-1.pdf}

\#Preprocessing data for modelling using recipes

What if we wanted to predict the price of a pumpkin based on the city or
package columns which are of type character? How could we find the
correlation between, say, package and price?

Machine learning models work best with numeric features rather than text
values, so you generally need to convert categorical features into
numeric representations.

This means that we have to find a way to reformat our predictors to make
them easier for a model to use effectively, a process known as
\textbf{feature engineering}.

Different models have different preprocessing requirements. For
instance, least squares requires encoding categorical variables such as
month, variety and city\_name. This simply involves translating a column
with categorical values into one or more numeric columns that take the
place of the original.

Now let's introduce another useful tidymodels package: recipes - which
will help you preprocess data before training your mode. A recipe is an
object that defines what steps should be applied to a data set in order
to get it ready for modelling.

Now, let's create a recipe that prepares our data for modelling by
substituting a unique integer for all the observations in the predictor
columns:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Specify a recipe}
\NormalTok{pumpkins\_recipe }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(price }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ new\_pumpkins) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{step\_integer}\NormalTok{(}\FunctionTok{all\_predictors}\NormalTok{(), }\AttributeTok{zero\_based =} \ConstantTok{TRUE}\NormalTok{)}


\CommentTok{\# Print out the recipe}
\NormalTok{pumpkins\_recipe}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
\end{verbatim}

\begin{verbatim}
## -- Recipe ----------------------------------------------------------------------
\end{verbatim}

\begin{verbatim}
## 
\end{verbatim}

\begin{verbatim}
## -- Inputs
\end{verbatim}

\begin{verbatim}
## Number of variables by role
\end{verbatim}

\begin{verbatim}
## outcome:   1
## predictor: 8
\end{verbatim}

\begin{verbatim}
## 
\end{verbatim}

\begin{verbatim}
## -- Operations
\end{verbatim}

\begin{verbatim}
## * Integer encoding for: all_predictors()
\end{verbatim}

OK, we created our first recipe that specifies an outcome (price) and
its corresponding predictors and that all the predictor columns should
be encoded into a set of integers. Let's quickly break it down:

The call to recipe() with a formula tells the recipe the roles of the
variables using new\_pumpkins data as the reference. For instance the
price column has been assigned an outcome role while the rest of the
columns have been assigned a predictor role.

step\_integer(all\_predictors(), zero\_based = TRUE) specifies that all
the predictors should be converted into a set of integers with the
numbering starting at 0.

How can we confirm that the recipe is doing what we intend? Once your
recipe is defined, you can estimate the parameters required to
preprocess the data, and then extract the processed data. You don't
typically need to do this when you use tidymodels (we'll see the normal
convention in just a minute with workflows) but its a good sanity check
for confirming that recipes are doing what you expect.

For that, you'll need two more verbs: prep() and bake()

prep(): estimates the required parameters from a training set that can
be later applied to other data sets.

bake(): takes a prepped recipe and applies the operations to any data
set.

Now let's prep and bake our recipes to confirm that under the hood, the
predictor columns will be first encoded before a model is fit.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Prep the recipe}
\NormalTok{pumpkins\_prep }\OtherTok{\textless{}{-}} \FunctionTok{prep}\NormalTok{(pumpkins\_recipe)}

\CommentTok{\# Bake the recipe to extract a preprocessed new\_pumpkins data}
\NormalTok{baked\_pumpkins }\OtherTok{\textless{}{-}} \FunctionTok{bake}\NormalTok{(pumpkins\_prep, }\AttributeTok{new\_data =} \ConstantTok{NULL}\NormalTok{)}

\CommentTok{\# Print out the baked data set}
\NormalTok{baked\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 9
##    variety city_name package low_price high_price  date   day month price
##      <int>     <int>   <int>     <int>      <int> <int> <int> <int> <dbl>
##  1       3         1       0         5          3     0     5     1  13.6
##  2       3         1       0        10          7     0     5     1  16.4
##  3       3         1       0        10          7     6    11     2  16.4
##  4       3         1       0         9          6     6    11     2  15.5
##  5       3         1       0         5          3     7    12     2  13.6
##  6       3         1       0        10          7     7    12     2  16.4
##  7       3         1       0         9          6     7    12     2  15.5
##  8       3         1       0         9          8     7    12     2  16.1
##  9       3         1       0         5          3     8    13     2  13.6
## 10       3         1       0         9          6     8    13     2  15.5
\end{verbatim}

The processed data baked\_pumpkins has all its predictors encoded
confirming that indeed the preprocessing steps defined as our recipe
will work as expected. This makes it harder for you to read but more
intelligible for tidymodels. Take a look at how the observations have
been mapped to numbers.

\emph{Question 5:} From looking at the baked\_pumpkins tibble, how many
total cities are represented in the data set?

\begin{itemize}
\tightlist
\item
  \textbf{Answer}: There is one city that is represented in the dataset.
\end{itemize}

baked\_pumpkins is a data frame that we can perform computations on. For
instance, let's try to find a good correlation between two variables to
potentially build a good predictive model. We'll use the function cor()
to do this.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Find the correlation between the package and the price}
\FunctionTok{cor}\NormalTok{(baked\_pumpkins}\SpecialCharTok{$}\NormalTok{package, baked\_pumpkins}\SpecialCharTok{$}\NormalTok{price)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6061713
\end{verbatim}

\emph{Question 6:} Calculate the correlation between pumpkin price and
two other variables in the data set

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Correlation between price and other vars.}
\CommentTok{\#days}
\FunctionTok{cor}\NormalTok{(baked\_pumpkins}\SpecialCharTok{$}\NormalTok{day, baked\_pumpkins}\SpecialCharTok{$}\NormalTok{price)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.1245279
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#month}
\FunctionTok{cor}\NormalTok{(baked\_pumpkins}\SpecialCharTok{$}\NormalTok{month, baked\_pumpkins}\SpecialCharTok{$}\NormalTok{price)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.1487829
\end{verbatim}

\emph{Question 7:} Which of these three variables is most highly
correlated with price? Why might this be?

-\textbf{Answer}: Out of the three variables that I have tested, the
variable package is highly correlated with price.

Now let's visualize a correlation matrix of all the columns using the
corrplot package.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load the corrplot package}
\FunctionTok{library}\NormalTok{(corrplot)}

\CommentTok{\# Obtain correlation matrix}
\NormalTok{corr\_mat }\OtherTok{\textless{}{-}} \FunctionTok{cor}\NormalTok{(baked\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
                  \CommentTok{\# Drop columns that are not really informative}
                  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(low\_price, high\_price)))}

\CommentTok{\# Make a correlation plot between the variables}
\FunctionTok{corrplot}\NormalTok{(corr\_mat, }\AttributeTok{method =} \StringTok{"shade"}\NormalTok{, }\AttributeTok{shade.col =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{tl.col =} \StringTok{"black"}\NormalTok{, }\AttributeTok{tl.srt =} \DecValTok{45}\NormalTok{, }\AttributeTok{addCoef.col =} \StringTok{"black"}\NormalTok{, }\AttributeTok{cl.pos =} \StringTok{"n"}\NormalTok{, }\AttributeTok{order =} \StringTok{"original"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Lab1_files/figure-latex/unnamed-chunk-17-1.pdf}

\hypertarget{build-a-linear-regression-model}{%
\subsection{Build a linear regression
model}\label{build-a-linear-regression-model}}

Now that we have build a recipe, and actually confirmed that the data
will be pre-processed appropriately, let's now build a regression model
to answer the question: What price can I expect of a given pumpkin
package?

\hypertarget{train-the-model-using-the-training-set}{%
\subsection{Train the model using the training
set}\label{train-the-model-using-the-training-set}}

As you may have already figured out, the column price is the outcome
variable while the package column is the predictor variable.

To do this, we'll first split the data. Data splitting is a key part of
the machine learning process. For now we'll do a 80/20 split, where 80\%
of the data goes into training and 20\% into the test set. Then we'll
define a recipe that will encode the predictor column into a set of
integers, then build a model specification. We won't prep and bake our
recipe since we already know it will preprocess the data as expected.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\CommentTok{\# Split the data into training and test sets}
\NormalTok{pumpkins\_split }\OtherTok{\textless{}{-}}\NormalTok{ new\_pumpkins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{initial\_split}\NormalTok{(}\AttributeTok{prop =} \FloatTok{0.8}\NormalTok{)}


\CommentTok{\# Extract training and test data}
\NormalTok{pumpkins\_train }\OtherTok{\textless{}{-}} \FunctionTok{training}\NormalTok{(pumpkins\_split)}
\NormalTok{pumpkins\_test }\OtherTok{\textless{}{-}} \FunctionTok{testing}\NormalTok{(pumpkins\_split)}


\CommentTok{\# Create a recipe for preprocessing the data}
\NormalTok{lm\_pumpkins\_recipe }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(price }\SpecialCharTok{\textasciitilde{}}\NormalTok{ package, }\AttributeTok{data =}\NormalTok{ pumpkins\_train) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{step\_integer}\NormalTok{(}\FunctionTok{all\_predictors}\NormalTok{(), }\AttributeTok{zero\_based =} \ConstantTok{TRUE}\NormalTok{)}


\CommentTok{\# Create a linear model specification}
\NormalTok{lm\_spec }\OtherTok{\textless{}{-}} \FunctionTok{linear\_reg}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{set\_engine}\NormalTok{(}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{set\_mode}\NormalTok{(}\StringTok{"regression"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now that we have a recipe and a model specification, we need to find a
way of bundling them together into an object that will first preprocess
the data (prep+bake behind the scenes), fit the model on the
preprocessed data and also allow for potential post-processing
activities.

So let's bundle everything up into a workflow. A workflow is a container
object that aggregates information required to fit and predict from a
model.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Hold modeling components in a workflow}
\NormalTok{lm\_wf }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_recipe}\NormalTok{(lm\_pumpkins\_recipe) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_model}\NormalTok{(lm\_spec)}

\CommentTok{\# Print out the workflow}
\NormalTok{lm\_wf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: linear_reg()
## 
## -- Preprocessor ----------------------------------------------------------------
## 1 Recipe Step
## 
## * step_integer()
## 
## -- Model -----------------------------------------------------------------------
## Linear Regression Model Specification (regression)
## 
## Computational engine: lm
\end{verbatim}

A workflow can be fit/trained in much the same way a model can.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Train the model}
\NormalTok{lm\_wf\_fit }\OtherTok{\textless{}{-}}\NormalTok{ lm\_wf }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{fit}\NormalTok{(}\AttributeTok{data =}\NormalTok{ pumpkins\_train)}

\CommentTok{\# Print the model coefficients learned }
\NormalTok{lm\_wf\_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## == Workflow [trained] ==========================================================
## Preprocessor: Recipe
## Model: linear_reg()
## 
## -- Preprocessor ----------------------------------------------------------------
## 1 Recipe Step
## 
## * step_integer()
## 
## -- Model -----------------------------------------------------------------------
## 
## Call:
## stats::lm(formula = ..y ~ ., data = data)
## 
## Coefficients:
## (Intercept)      package  
##       20.14         4.76
\end{verbatim}

From the model output, we can see the coefficients learned during
training. They represent the coefficients of the line of best fit that
gives us the lowest overall error between the actual and predicted
variable.

Evaluate model performance using the test set. It's time to see how the
model performed! How do we do this?

Now that we've trained the model, we can use it to make predictions for
the test\_set using parsnip::predict(). Then we can compare these
predictions to the actual label values to evaluate how well (or not!)
the model is working.

Let's start with making predictions for the test set then bind the
columns to the test set.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Make predictions for the test set}
\NormalTok{predictions }\OtherTok{\textless{}{-}}\NormalTok{ lm\_wf\_fit }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{predict}\NormalTok{(}\AttributeTok{new\_data =}\NormalTok{ pumpkins\_test)}


\CommentTok{\# Bind predictions to the test set}
\NormalTok{lm\_results }\OtherTok{\textless{}{-}}\NormalTok{ pumpkins\_test }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(package, price)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{bind\_cols}\NormalTok{(predictions)}


\CommentTok{\# Print the first ten rows of the tibble}
\NormalTok{lm\_results }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    package              price .pred
##    <chr>                <dbl> <dbl>
##  1 1 1/9 bushel cartons  13.6  20.1
##  2 1 1/9 bushel cartons  16.4  20.1
##  3 1 1/9 bushel cartons  16.4  20.1
##  4 1 1/9 bushel cartons  13.6  20.1
##  5 1 1/9 bushel cartons  15.5  20.1
##  6 1 1/9 bushel cartons  16.4  20.1
##  7 1/2 bushel cartons    34    29.7
##  8 1/2 bushel cartons    30    29.7
##  9 1/2 bushel cartons    30    29.7
## 10 1/2 bushel cartons    34    29.7
\end{verbatim}

OK, you have just trained a model and used it to make predictions! Let's
evaluate the model's performance.

In tidymodels, we do this using yardstick::metrics(). For linear
regression, let's focus on the following metrics:

Root Mean Square Error (RMSE): The square root of the MSE. This yields
an absolute metric in the same unit as the label (in this case, the
price of a pumpkin). The smaller the value, the better the model (in a
simplistic sense, it represents the average price by which the
predictions are wrong)

Coefficient of Determination (usually known as R-squared or R2): A
relative metric in which the higher the value, the better the fit of the
model. In essence, this metric represents how much of the variance
between predicted and actual label values the model is able to explain.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Evaluate performance of linear regression}
\FunctionTok{metrics}\NormalTok{(}\AttributeTok{data =}\NormalTok{ lm\_results,}
        \AttributeTok{truth =}\NormalTok{ price,}
        \AttributeTok{estimate =}\NormalTok{ .pred)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   .metric .estimator .estimate
##   <chr>   <chr>          <dbl>
## 1 rmse    standard       7.23 
## 2 rsq     standard       0.495
## 3 mae     standard       5.94
\end{verbatim}

OK, so that is the model performance. Let's see if we can get a better
indication by visualizing a scatter plot of the package and price then
use the predictions made to overlay a line of best fit.

This means we'll have to prep and bake the test set in order to encode
the package column then bind this to the predictions made by our model.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Encode package column}
\NormalTok{package\_encode }\OtherTok{\textless{}{-}}\NormalTok{ lm\_pumpkins\_recipe }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prep}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{bake}\NormalTok{(}\AttributeTok{new\_data =}\NormalTok{ pumpkins\_test) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(package)}


\CommentTok{\# Bind encoded package column to the results}
\NormalTok{ plot\_results }\OtherTok{\textless{}{-}}\NormalTok{ lm\_results }\SpecialCharTok{\%\textgreater{}\%}
 \FunctionTok{bind\_cols}\NormalTok{(package\_encode }\SpecialCharTok{\%\textgreater{}\%}
               \FunctionTok{rename}\NormalTok{(}\AttributeTok{package\_integer =}\NormalTok{ package)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{relocate}\NormalTok{(package\_integer, }\AttributeTok{.after =}\NormalTok{ package)}

\CommentTok{\# Print new results data frame}
\NormalTok{plot\_results }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 4
##   package              package_integer price .pred
##   <chr>                          <int> <dbl> <dbl>
## 1 1 1/9 bushel cartons               0  13.6  20.1
## 2 1 1/9 bushel cartons               0  16.4  20.1
## 3 1 1/9 bushel cartons               0  16.4  20.1
## 4 1 1/9 bushel cartons               0  13.6  20.1
## 5 1 1/9 bushel cartons               0  15.5  20.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Make a scatter plot}
\NormalTok{plot\_results }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ package\_integer, }\AttributeTok{y =}\NormalTok{ price)) }\SpecialCharTok{+}
   \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \FloatTok{1.6}\NormalTok{) }\SpecialCharTok{+}
   \CommentTok{\# Overlay a line of best fit}
   \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ .pred), }\AttributeTok{color =} \StringTok{"orange"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{1.2}\NormalTok{) }\SpecialCharTok{+}
   \FunctionTok{xlab}\NormalTok{(}\StringTok{"package"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Lab1_files/figure-latex/encode_package-1.pdf}

Hmm. The model does not do good job of generalizing the relationship
between a package and its corresponding price.

\emph{Question 8:} What issues do you see with fitting a linear
regression to this data?

\begin{itemize}
\tightlist
\item
  \textbf{Answer}: While the outputs that we get are continuous, meaning
  that they only contain whole numbers, the inputs that we are putting
  in for packages are discrete. This means that the model does not know
  what the price is for a half of a bundle and has to estimate with the
  data it is given from the price of 0 bundles and 1 bundle.
\end{itemize}

Congratulations, you just created a model that can help predict the
price of a few varieties of pumpkins. But you can probably create a
better model! To be continued next week\ldots{}

\end{document}
